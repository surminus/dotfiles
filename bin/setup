#!/bin/bash
#
# dotfiles setup
set -e

case $1 in
  'install')
    if [[ ! -d ~/.dotfiles ]]; then
      git clone https://github.com/surminus/dotfiles ~/.dotfiles
    else
      cd ~/.dotfiles && git pull
    fi

    for i in gitconfig vimrc zshrc ackrc colordiffrc; do
      echo "Linking $i"
      test -f ~/.$i && mv ~/.$i ~/.$i.bak-$(date +%F)
      ln -s ~/.dotfiles/$i ~/.$i
    done
    ;;

  'link')
    for i in gitconfig vimrc zshrc ackrc colordiffrc; do
      echo "Linking $i"
      test -f ~/.$i && mv ~/.$i ~/.$i.bak-$(date +%F)
      ln -s ~/.dotfiles/$i ~/.$i
    done
    ;;

  # Dotfile specific
  'fetch')
    cd ~/.dotfiles && git pull;;
  'add')
    cd ~/.dotfiles && git add -p && git commit -v;;
  'push')
    cd ~/.dotfiles && git push origin HEAD;;
  'sync')
    cd ~/.dotfiles && \
      git pull && \
      git add -p && \
      git commit -v && \
      git push origin HEAD;;

  'brewfile')
    cd ~/.dotfiles && \
    brew bundle dump --force && \
    git add -p Brewfile && \
    git commit -m "Brewfile updates" && \
    git push origin HEAD;;

  *) echo "Run $0 [install|link|fetch|add|push|sync]" && exit 1;;
esac
